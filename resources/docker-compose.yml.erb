version: '3'

services:

  rails:
    build:
      context: .
      dockerfile: ./rockered/DockerfileRails
      args:
        buildno: 1
    expose:
      - <%= defined?(application_port) ? application_port : '5000' %>
    ports:
      - <%= defined?(application_port) ? "#{application_port}:#{application_port}" : '5000:5000' %>
    links:
      - 'mysql:databasehost'

  <%= database %>:
    context: .
      dockerfile: ./<%= database_dockerfile %>
      args:
        buildno: 1
    volumes:
      - '.<%= defined?(data_dir) ? data_dir : '/rockered/data_dir' %>:/var/lib/mysql:rw'
    ports:
      - '3306:3306'
    environment:
      - MYSQL_ROOT_PASSWORD=root
