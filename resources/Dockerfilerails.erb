FROM rails:<%= defined?(rails_version) ? rails_version : 5 %>

RUN gem install bundler

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

COPY ./Gemfile /usr/src/app/
COPY ./Gemfile.lock /usr/src/app/
RUN bundle install

COPY . /usr/src/app
COPY ./<%= PATHS.relative_from_current(PATHS.config) %>/entry-point.sh /usr/src/app/entry-point.sh
COPY ./<%= PATHS.relative_from_current(PATHS.config) %>/database.yml /usr/src/app/config/database.yml
COPY ./<%= PATHS.relative_from_current(PATHS.config) %>/secrets.yml /usr/src/app/config/secrets.yml

EXPOSE <%= defined?(application_port) ? application_port : 5000 %>
CMD ["bash", "/usr/src/app/entry-point.sh"]
