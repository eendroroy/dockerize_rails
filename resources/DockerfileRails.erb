FROM rails:<%= defined?(rails_version) ? rails_version : 5 %>

RUN gem install bundler

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

COPY ./Gemfile /usr/src/app/
COPY ./Gemfile.lock /usr/src/app/
RUN bundle install

COPY . /usr/src/app
COPY ./docker/entry-point.sh /usr/src/app/entry-point.sh
COPY ./rockered/database.yml /usr/src/app/database.yml

EXPOSE <%= defined?(application_port) ? application_port : 5000 %>
CMD ["bash", "entry-point.sh"]
